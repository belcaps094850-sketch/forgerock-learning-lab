<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Auth Flows Best Practices ‚Äî Bel Learning Lab</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: Arial, sans-serif; background: #fff; color: #333; line-height: 1.6; }
.container { max-width: 900px; margin: 0 auto; padding: 40px 20px 60px; }
a.back { display: inline-block; margin-bottom: 24px; color: #3498db; text-decoration: none; font-size: 14px; }
a.back:hover { text-decoration: underline; }
h1 { font-size: 28px; color: #2c3e50; margin-bottom: 6px; }
.subtitle { color: #7f8c8d; font-size: 16px; margin-bottom: 32px; }
h2 { font-size: 22px; color: #2c3e50; margin: 36px 0 16px; padding-bottom: 6px; border-bottom: 2px solid #ecf0f1; }
h3 { font-size: 17px; color: #2c3e50; margin: 20px 0 10px; }
p, li { font-size: 15px; }
ul { margin: 0 0 16px 24px; }
li { margin-bottom: 6px; }

/* Flow diagrams */
.flow { display: flex; align-items: center; flex-wrap: wrap; gap: 0; margin: 16px 0 24px; }
.flow-step { background: #eaf2f8; border: 2px solid #3498db; border-radius: 6px; padding: 10px 16px; font-size: 13px; font-weight: bold; color: #2c3e50; text-align: center; min-width: 100px; max-width: 180px; }
.flow-step.alt { background: #fef9e7; border-color: #f1c40f; }
.flow-step.success { background: #eafaf1; border-color: #27ae60; }
.flow-step.danger { background: #fdedec; border-color: #e74c3c; }
.flow-arrow { font-size: 20px; color: #95a5a6; padding: 0 6px; flex-shrink: 0; }
.flow-label { font-size: 11px; font-weight: normal; color: #7f8c8d; display: block; margin-top: 3px; }

/* Impl notes */
.impl { background: #f8f9fa; border-left: 4px solid #3498db; padding: 14px 18px; margin: 16px 0; border-radius: 0 4px 4px 0; }
.impl strong { color: #2c3e50; }
.impl code { background: #e8e8e8; padding: 1px 5px; border-radius: 3px; font-size: 13px; }

/* NIST callout */
.nist { background: #fef9e7; border-left: 4px solid #f1c40f; padding: 14px 18px; margin: 16px 0; border-radius: 0 4px 4px 0; font-size: 14px; }

footer { text-align: center; padding: 24px 20px; border-top: 1px solid #ecf0f1; color: #95a5a6; font-size: 13px; margin-top: 30px; }
footer a { color: #3498db; text-decoration: none; }
</style>
</head>
<body>

<div class="container">
<a href="index.html" class="back">‚Üê Back to Learning Lab</a>
<h1>üîë Auth Flows Best Practices</h1>
<p class="subtitle">Registration, Forgot Password &amp; Account Recovery ‚Äî with ForgeRock implementation notes</p>

<!-- ============================================================ -->
<h2>1. Registration Flow</h2>

<h3>Recommended Flow</h3>
<div class="flow">
  <div class="flow-step">User clicks "Sign Up"</div>
  <div class="flow-arrow">‚Üí</div>
  <div class="flow-step">Collect email + password<span class="flow-label">minimal fields</span></div>
  <div class="flow-arrow">‚Üí</div>
  <div class="flow-step alt">Email verification<span class="flow-label">magic link or OTP</span></div>
  <div class="flow-arrow">‚Üí</div>
  <div class="flow-step">Profile enrichment<span class="flow-label">progressive profiling</span></div>
  <div class="flow-arrow">‚Üí</div>
  <div class="flow-step success">Account created ‚úì</div>
</div>

<h3>Best Practices</h3>
<ul>
  <li><strong>Minimize initial fields</strong> ‚Äî collect only email and password (or go passwordless). Ask for name, phone, preferences later via progressive profiling.</li>
  <li><strong>Real-time validation</strong> ‚Äî show password strength, email format, and username availability inline as the user types.</li>
  <li><strong>Social / federated sign-up</strong> ‚Äî offer Google, Apple, or enterprise IdP options to reduce friction.</li>
  <li><strong>Verify email before granting full access</strong> ‚Äî send a magic link or 6-digit OTP. Don't rely solely on "click this link in 24 hours."</li>
  <li><strong>Progressive profiling</strong> ‚Äî gather additional attributes (phone, MFA setup, preferences) across subsequent logins, not all at once.</li>
  <li><strong>Passwordless option</strong> ‚Äî consider WebAuthn / passkeys as the primary credential, falling back to email OTP.</li>
  <li><strong>Bot protection</strong> ‚Äî use CAPTCHA or risk scoring (e.g., reCAPTCHA Enterprise) on the registration page.</li>
  <li><strong>Comply with NIST 800-63B</strong> ‚Äî don't enforce arbitrary complexity rules; check against breached-password lists instead; require minimum 8 characters.</li>
</ul>

<div class="nist">
  <strong>üìã NIST 800-63B:</strong> Verifiers SHALL require passwords ‚â• 8 characters, SHOULD allow up to 64+, and SHALL compare against known-breached corpora. Composition rules (uppercase + symbol) are NOT recommended.
</div>

<div class="impl">
  <strong>ForgeRock Implementation:</strong> Build a <code>Registration</code> journey in PingOne AIC (or AM). Use the <strong>Page Node</strong> to combine Attribute Collector + Password Collector on one screen. Add a <strong>Create Object</strong> node ‚Üí <strong>Email Suspend Node</strong> (sends verification link) ‚Üí on resume, <strong>Patch Object</strong> to set <code>emailVerified=true</code>. For progressive profiling, create a separate <code>Progressive Profile</code> journey triggered by an inner-tree evaluator on subsequent logins that checks if attributes like <code>telephoneNumber</code> are missing. Use the <strong>HaveIBeenPwned</strong> integration node to check breached passwords at registration time.
</div>

<!-- ============================================================ -->
<h2>2. Forgot Password Flow</h2>

<h3>Recommended Flow</h3>
<div class="flow">
  <div class="flow-step">User clicks "Forgot Password"</div>
  <div class="flow-arrow">‚Üí</div>
  <div class="flow-step">Enter email address</div>
  <div class="flow-arrow">‚Üí</div>
  <div class="flow-step alt">Send reset link / OTP<span class="flow-label">time-limited token</span></div>
  <div class="flow-arrow">‚Üí</div>
  <div class="flow-step">User verifies identity<span class="flow-label">clicks link or enters code</span></div>
  <div class="flow-arrow">‚Üí</div>
  <div class="flow-step">Set new password</div>
  <div class="flow-arrow">‚Üí</div>
  <div class="flow-step success">Password updated ‚úì<span class="flow-label">invalidate old sessions</span></div>
</div>

<h3>Best Practices</h3>
<ul>
  <li><strong>Generic response</strong> ‚Äî always say "If an account exists, we sent a reset link." Never reveal whether an email is registered (prevents user enumeration).</li>
  <li><strong>Short-lived tokens</strong> ‚Äî reset links should expire in 15‚Äì60 minutes. One-time use only.</li>
  <li><strong>Rate limit</strong> ‚Äî throttle reset requests per email and per IP to prevent abuse.</li>
  <li><strong>Invalidate existing sessions</strong> ‚Äî after a successful password reset, revoke all active sessions and refresh tokens for that user.</li>
  <li><strong>Notify the user</strong> ‚Äî send an email confirming the password was changed (to the old and/or new email).</li>
  <li><strong>Don't use security questions</strong> ‚Äî they're easily guessable. Use email/SMS OTP or passkey verification instead.</li>
  <li><strong>Step-up if available</strong> ‚Äî if the user has MFA enrolled, require the second factor during reset for higher assurance.</li>
</ul>

<div class="nist">
  <strong>üìã NIST 800-63B ¬ß5.1.1.2:</strong> Memorized secret verifiers SHALL implement a rate-limiting mechanism that limits the number of failed authentication attempts. Look-up secrets (reset tokens) SHALL be single-use and expire after a defined period.
</div>

<div class="impl">
  <strong>ForgeRock Implementation:</strong> Use the built-in <code>Forgot Password</code> journey template or build custom: <strong>Page Node</strong> (username collector) ‚Üí <strong>Identify Existing User</strong> ‚Üí <strong>Email Suspend Node</strong> with a reset link containing a one-time token. On resume: <strong>Attribute Collector</strong> (new password) ‚Üí <strong>Patch Object</strong> to update password ‚Üí <strong>Session Invalidation Node</strong> (or scripted node calling <code>/sessions?_action=logoutByUser</code>). Add a <strong>Message Node</strong> for the generic "check your email" response regardless of user existence. Set token TTL in the Email Suspend Node config (default 300s ‚Äî increase to 3600s for production).
</div>

<!-- ============================================================ -->
<h2>3. Account Recovery Flow</h2>

<h3>Recommended Flow</h3>
<div class="flow">
  <div class="flow-step">User cannot access account<span class="flow-label">locked out / lost MFA</span></div>
  <div class="flow-arrow">‚Üí</div>
  <div class="flow-step">Select recovery method<span class="flow-label">email, SMS, backup codes</span></div>
  <div class="flow-arrow">‚Üí</div>
  <div class="flow-step alt">Verify identity<span class="flow-label">multi-channel proof</span></div>
  <div class="flow-arrow">‚Üí</div>
  <div class="flow-step alt">Step-up verification<span class="flow-label">if risk is elevated</span></div>
  <div class="flow-arrow">‚Üí</div>
  <div class="flow-step">Re-enroll credentials<span class="flow-label">new MFA / password</span></div>
  <div class="flow-arrow">‚Üí</div>
  <div class="flow-step success">Access restored ‚úì</div>
</div>

<h3>Scenario Comparison</h3>
<table style="width:100%; border-collapse:collapse; font-size:14px; margin:16px 0;">
  <thead>
    <tr style="background:#f8f9fa; text-align:left;">
      <th style="padding:8px; border:1px solid #ddd;">Scenario</th>
      <th style="padding:8px; border:1px solid #ddd;">Recovery Method</th>
      <th style="padding:8px; border:1px solid #ddd;">Risk Level</th>
    </tr>
  </thead>
  <tbody>
    <tr><td style="padding:8px; border:1px solid #ddd;">Lost password (has MFA)</td><td style="padding:8px; border:1px solid #ddd;">Email reset + MFA verify</td><td style="padding:8px; border:1px solid #ddd;">Low</td></tr>
    <tr><td style="padding:8px; border:1px solid #ddd;">Lost MFA device</td><td style="padding:8px; border:1px solid #ddd;">Backup codes ‚Üí re-enroll MFA</td><td style="padding:8px; border:1px solid #ddd;">Medium</td></tr>
    <tr><td style="padding:8px; border:1px solid #ddd;">Lost password + MFA</td><td style="padding:8px; border:1px solid #ddd;">Email + SMS + identity proofing</td><td style="padding:8px; border:1px solid #ddd;">High</td></tr>
    <tr><td style="padding:8px; border:1px solid #ddd;">Compromised account</td><td style="padding:8px; border:1px solid #ddd;">Admin-assisted + full re-enrollment</td><td style="padding:8px; border:1px solid #ddd;">Critical</td></tr>
  </tbody>
</table>

<h3>Best Practices</h3>
<ul>
  <li><strong>Provide backup codes at MFA enrollment</strong> ‚Äî generate 8‚Äì10 single-use recovery codes and prompt the user to save them. This is the #1 way to reduce support tickets.</li>
  <li><strong>Multiple recovery channels</strong> ‚Äî let users register a recovery email AND phone. If one is compromised, the other acts as a fallback.</li>
  <li><strong>Adaptive risk assessment</strong> ‚Äî if the recovery request comes from a new device/location, require additional verification (e.g., government ID scan or video selfie).</li>
  <li><strong>Escalation path</strong> ‚Äî for high-risk scenarios (lost all factors), provide a clear path to human-assisted recovery with identity proofing.</li>
  <li><strong>Audit logging</strong> ‚Äî log every recovery attempt, successful or not, for compliance and fraud detection.</li>
  <li><strong>Cooldown periods</strong> ‚Äî after account recovery, restrict sensitive actions (password change, email change) for 24‚Äì48 hours to limit damage from social engineering.</li>
  <li><strong>Re-enroll, don't just restore</strong> ‚Äî after recovery, force MFA re-enrollment rather than restoring the old configuration.</li>
</ul>

<div class="nist">
  <strong>üìã NIST 800-63B ¬ß6.1.2.3:</strong> Recovery of an authenticator requires proof of the same or higher AAL as the authenticator being replaced. Recovery SHALL NOT downgrade the assurance level. Backup authenticators (recovery codes) should be issued at enrollment time.
</div>

<div class="impl">
  <strong>ForgeRock Implementation:</strong> Build an <code>Account Recovery</code> journey with branching logic: <strong>Choice Collector</strong> (recovery method selection) ‚Üí branch to Email Suspend, SMS OTP, or Backup Code verification. Use a <strong>Scripted Decision Node</strong> to check which recovery factors the user has enrolled. For backup codes, use <code>fr-attr: recovery-codes</code> in the user profile and a scripted node to validate + consume codes. After verification, route to an <strong>MFA Registration</strong> inner journey to re-enroll. Use the <strong>Account Lockout Node</strong> or scripted <code>inetUserStatus</code> check for locked accounts. For high-risk recovery, integrate <strong>Onfido</strong> or <strong>Jumio</strong> via marketplace connectors for document verification. Enable <strong>Audit Logging</strong> at the journey level ‚Äî all events write to <code>am-authentication</code> topic.
</div>

<!-- ============================================================ -->
<h2>Summary: Key Principles</h2>
<ul>
  <li><strong>Minimize friction at every step</strong> ‚Äî only ask for what you need, when you need it.</li>
  <li><strong>Never reveal account existence</strong> ‚Äî generic messages prevent enumeration attacks.</li>
  <li><strong>Defense in depth</strong> ‚Äî layer email + OTP + risk signals; no single point of failure.</li>
  <li><strong>Follow NIST 800-63B</strong> ‚Äî it's the gold standard for digital identity. No security questions, no arbitrary password rules.</li>
  <li><strong>Plan for loss</strong> ‚Äî every enrolled credential must have a recovery path planned upfront.</li>
  <li><strong>Log everything</strong> ‚Äî authentication and recovery events are critical for security and compliance.</li>
  <li><strong>ForgeRock journeys are composable</strong> ‚Äî use inner trees for reusable sub-flows (MFA enrollment, email verification) shared across registration, login, and recovery.</li>
</ul>

</div>

<footer>
  Built by Bel ¬∑ <a href="index.html">Back to Learning Lab</a>
</footer>

</body>
</html>
