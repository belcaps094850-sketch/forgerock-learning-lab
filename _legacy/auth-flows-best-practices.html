<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸ§ª</text></svg>" />
<link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display&family=Inter:wght@400;500;600&display=swap" rel="stylesheet" />
<title>Auth Flows Best Practices â€” Bel Learning Lab</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
  font-family: 'Inter', Arial, sans-serif;
  background-color: #96A396;
  color: #333;
  line-height: 1.6;
  min-height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 40px 20px;
}
.card-wrapper {
  background: #F5F7F0;
  border-radius: 24px;
  max-width: 1100px;
  width: 100%;
  box-shadow: 0 20px 60px rgba(0,0,0,0.12);
  overflow: hidden;
}
nav {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 24px 48px;
}
.logo {
  font-family: 'DM Serif Display', serif;
  font-size: 24px;
  color: #1A1A1A;
  text-decoration: none;
}
.logo span { color: #D4872E; }
.nav-links {
  display: flex;
  gap: 32px;
  list-style: none;
}
.nav-links a {
  color: #333;
  text-decoration: none;
  font-size: 14px;
  font-weight: 500;
  transition: color 0.15s;
}
.nav-links a:hover, .nav-links a.active { color: #2B5F4E; }
.nav-cta {
  background: #2B5F4E;
  color: #fff;
  padding: 10px 24px;
  border-radius: 8px;
  text-decoration: none;
  font-size: 14px;
  font-weight: 500;
  transition: background 0.15s;
}
.nav-cta:hover { background: #1B4D3E; }

.content {
  max-width: 800px;
  margin: 0 auto;
  padding: 20px 48px 48px;
}

h1 {
  font-family: 'DM Serif Display', serif;
  font-size: 28px;
  color: #1A1A1A;
  margin-bottom: 6px;
}
.subtitle { color: #6B7280; font-size: 16px; margin-bottom: 32px; }
h2 {
  font-family: 'DM Serif Display', serif;
  font-size: 22px;
  color: #1A1A1A;
  margin: 36px 0 16px;
  padding-bottom: 6px;
  border-bottom: 2px solid rgba(0,0,0,0.06);
}
h3 { font-size: 17px; color: #1A1A1A; margin: 20px 0 10px; }
p, li { font-size: 15px; }
ul { margin: 0 0 16px 24px; }
li { margin-bottom: 6px; }

.flow { display: flex; align-items: center; flex-wrap: wrap; gap: 0; margin: 16px 0 24px; }
.flow-step { background: #eef5f0; border: 2px solid #2B5F4E; border-radius: 6px; padding: 10px 16px; font-size: 13px; font-weight: bold; color: #1A1A1A; text-align: center; min-width: 100px; max-width: 180px; }
.flow-step.alt { background: #fef9e7; border-color: #D4872E; }
.flow-step.success { background: #eafaf1; border-color: #27ae60; }
.flow-step.danger { background: #fdedec; border-color: #e74c3c; }
.flow-arrow { font-size: 20px; color: #96A396; padding: 0 6px; flex-shrink: 0; }
.flow-label { font-size: 11px; font-weight: normal; color: #6B7280; display: block; margin-top: 3px; }

.impl { background: #fff; border-left: 4px solid #2B5F4E; padding: 14px 18px; margin: 16px 0; border-radius: 0 8px 8px 0; }
.impl strong { color: #1A1A1A; }
.impl code { background: #e8e8e8; padding: 1px 5px; border-radius: 3px; font-size: 13px; }

.nist { background: #fef9e7; border-left: 4px solid #D4872E; padding: 14px 18px; margin: 16px 0; border-radius: 0 8px 8px 0; font-size: 14px; }

table { width: 100%; border-collapse: collapse; font-size: 14px; margin: 16px 0; }
th { text-align: left; padding: 8px 10px; background: #fff; border-bottom: 2px solid rgba(0,0,0,0.06); color: #6B7280; font-size: 13px; }
td { padding: 8px 10px; border-bottom: 1px solid rgba(0,0,0,0.06); }

footer {
  text-align: center;
  padding: 20px 48px 28px;
  border-top: 1px solid rgba(0,0,0,0.06);
  color: #6B7280;
  font-size: 13px;
}
footer a { color: #2B5F4E; text-decoration: none; font-weight: 500; }
footer a:hover { text-decoration: underline; }

@media (max-width: 768px) {
  body { padding: 16px; }
  nav { padding: 20px 24px; flex-wrap: wrap; gap: 12px; }
  .nav-links { display: none; }
  .content { padding: 20px 24px 36px; }
  .flow { flex-direction: column; align-items: flex-start; }
  .flow-arrow { transform: rotate(90deg); padding: 4px 0; }
  footer { padding: 16px 24px 20px; }
}
</style>
</head>
<body>

<div class="card-wrapper">

<nav>
  <a href="index.html" class="logo"><span>Bel</span> Learning Lab</a>
  <ul class="nav-links">
    <li><a href="index.html">Home</a></li>
    <li><a href="book-notes.html">Books</a></li>
    <li><a href="daily-brief.html">Briefs</a></li>
    <li><a href="poc-playground.html" class="active">POCs</a></li>
    <li><a href="changelog.html">Changelog</a></li>
  </ul>
  <a href="https://github.com/belcaps094850-sketch/forgerock-learning-lab" target="_blank" class="nav-cta">View on GitHub</a>
</nav>

<div class="content">

<h1>ðŸ”‘ Auth Flows Best Practices</h1>
<p class="subtitle">Registration, Forgot Password &amp; Account Recovery â€” with ForgeRock implementation notes</p>

<h2>1. Registration Flow</h2>

<h3>Recommended Flow</h3>
<div class="flow">
  <div class="flow-step">User clicks "Sign Up"</div>
  <div class="flow-arrow">â†’</div>
  <div class="flow-step">Collect email + password<span class="flow-label">minimal fields</span></div>
  <div class="flow-arrow">â†’</div>
  <div class="flow-step alt">Email verification<span class="flow-label">magic link or OTP</span></div>
  <div class="flow-arrow">â†’</div>
  <div class="flow-step">Profile enrichment<span class="flow-label">progressive profiling</span></div>
  <div class="flow-arrow">â†’</div>
  <div class="flow-step success">Account created âœ“</div>
</div>

<h3>Best Practices</h3>
<ul>
  <li><strong>Minimize initial fields</strong> â€” collect only email and password (or go passwordless). Ask for name, phone, preferences later via progressive profiling.</li>
  <li><strong>Real-time validation</strong> â€” show password strength, email format, and username availability inline as the user types.</li>
  <li><strong>Social / federated sign-up</strong> â€” offer Google, Apple, or enterprise IdP options to reduce friction.</li>
  <li><strong>Verify email before granting full access</strong> â€” send a magic link or 6-digit OTP. Don't rely solely on "click this link in 24 hours."</li>
  <li><strong>Progressive profiling</strong> â€” gather additional attributes (phone, MFA setup, preferences) across subsequent logins, not all at once.</li>
  <li><strong>Passwordless option</strong> â€” consider WebAuthn / passkeys as the primary credential, falling back to email OTP.</li>
  <li><strong>Bot protection</strong> â€” use CAPTCHA or risk scoring (e.g., reCAPTCHA Enterprise) on the registration page.</li>
  <li><strong>Comply with NIST 800-63B</strong> â€” don't enforce arbitrary complexity rules; check against breached-password lists instead; require minimum 8 characters.</li>
</ul>

<div class="nist">
  <strong>ðŸ“‹ NIST 800-63B:</strong> Verifiers SHALL require passwords â‰¥ 8 characters, SHOULD allow up to 64+, and SHALL compare against known-breached corpora. Composition rules (uppercase + symbol) are NOT recommended.
</div>

<div class="impl">
  <strong>ForgeRock Implementation:</strong> Build a <code>Registration</code> journey in PingOne AIC (or AM). Use the <strong>Page Node</strong> to combine Attribute Collector + Password Collector on one screen. Add a <strong>Create Object</strong> node â†’ <strong>Email Suspend Node</strong> (sends verification link) â†’ on resume, <strong>Patch Object</strong> to set <code>emailVerified=true</code>. For progressive profiling, create a separate <code>Progressive Profile</code> journey triggered by an inner-tree evaluator on subsequent logins that checks if attributes like <code>telephoneNumber</code> are missing. Use the <strong>HaveIBeenPwned</strong> integration node to check breached passwords at registration time.
</div>

<h2>2. Forgot Password Flow</h2>

<h3>Recommended Flow</h3>
<div class="flow">
  <div class="flow-step">User clicks "Forgot Password"</div>
  <div class="flow-arrow">â†’</div>
  <div class="flow-step">Enter email address</div>
  <div class="flow-arrow">â†’</div>
  <div class="flow-step alt">Send reset link / OTP<span class="flow-label">time-limited token</span></div>
  <div class="flow-arrow">â†’</div>
  <div class="flow-step">User verifies identity<span class="flow-label">clicks link or enters code</span></div>
  <div class="flow-arrow">â†’</div>
  <div class="flow-step">Set new password</div>
  <div class="flow-arrow">â†’</div>
  <div class="flow-step success">Password updated âœ“<span class="flow-label">invalidate old sessions</span></div>
</div>

<h3>Best Practices</h3>
<ul>
  <li><strong>Generic response</strong> â€” always say "If an account exists, we sent a reset link." Never reveal whether an email is registered (prevents user enumeration).</li>
  <li><strong>Short-lived tokens</strong> â€” reset links should expire in 15â€“60 minutes. One-time use only.</li>
  <li><strong>Rate limit</strong> â€” throttle reset requests per email and per IP to prevent abuse.</li>
  <li><strong>Invalidate existing sessions</strong> â€” after a successful password reset, revoke all active sessions and refresh tokens for that user.</li>
  <li><strong>Notify the user</strong> â€” send an email confirming the password was changed (to the old and/or new email).</li>
  <li><strong>Don't use security questions</strong> â€” they're easily guessable. Use email/SMS OTP or passkey verification instead.</li>
  <li><strong>Step-up if available</strong> â€” if the user has MFA enrolled, require the second factor during reset for higher assurance.</li>
</ul>

<div class="nist">
  <strong>ðŸ“‹ NIST 800-63B Â§5.1.1.2:</strong> Memorized secret verifiers SHALL implement a rate-limiting mechanism that limits the number of failed authentication attempts. Look-up secrets (reset tokens) SHALL be single-use and expire after a defined period.
</div>

<div class="impl">
  <strong>ForgeRock Implementation:</strong> Use the built-in <code>Forgot Password</code> journey template or build custom: <strong>Page Node</strong> (username collector) â†’ <strong>Identify Existing User</strong> â†’ <strong>Email Suspend Node</strong> with a reset link containing a one-time token. On resume: <strong>Attribute Collector</strong> (new password) â†’ <strong>Patch Object</strong> to update password â†’ <strong>Session Invalidation Node</strong> (or scripted node calling <code>/sessions?_action=logoutByUser</code>). Add a <strong>Message Node</strong> for the generic "check your email" response regardless of user existence. Set token TTL in the Email Suspend Node config (default 300s â€” increase to 3600s for production).
</div>

<h2>3. Account Recovery Flow</h2>

<h3>Recommended Flow</h3>
<div class="flow">
  <div class="flow-step">User cannot access account<span class="flow-label">locked out / lost MFA</span></div>
  <div class="flow-arrow">â†’</div>
  <div class="flow-step">Select recovery method<span class="flow-label">email, SMS, backup codes</span></div>
  <div class="flow-arrow">â†’</div>
  <div class="flow-step alt">Verify identity<span class="flow-label">multi-channel proof</span></div>
  <div class="flow-arrow">â†’</div>
  <div class="flow-step alt">Step-up verification<span class="flow-label">if risk is elevated</span></div>
  <div class="flow-arrow">â†’</div>
  <div class="flow-step">Re-enroll credentials<span class="flow-label">new MFA / password</span></div>
  <div class="flow-arrow">â†’</div>
  <div class="flow-step success">Access restored âœ“</div>
</div>

<h3>Scenario Comparison</h3>
<table>
  <thead>
    <tr>
      <th>Scenario</th>
      <th>Recovery Method</th>
      <th>Risk Level</th>
    </tr>
  </thead>
  <tbody>
    <tr><td>Lost password (has MFA)</td><td>Email reset + MFA verify</td><td>Low</td></tr>
    <tr><td>Lost MFA device</td><td>Backup codes â†’ re-enroll MFA</td><td>Medium</td></tr>
    <tr><td>Lost password + MFA</td><td>Email + SMS + identity proofing</td><td>High</td></tr>
    <tr><td>Compromised account</td><td>Admin-assisted + full re-enrollment</td><td>Critical</td></tr>
  </tbody>
</table>

<h3>Best Practices</h3>
<ul>
  <li><strong>Provide backup codes at MFA enrollment</strong> â€” generate 8â€“10 single-use recovery codes and prompt the user to save them. This is the #1 way to reduce support tickets.</li>
  <li><strong>Multiple recovery channels</strong> â€” let users register a recovery email AND phone. If one is compromised, the other acts as a fallback.</li>
  <li><strong>Adaptive risk assessment</strong> â€” if the recovery request comes from a new device/location, require additional verification (e.g., government ID scan or video selfie).</li>
  <li><strong>Escalation path</strong> â€” for high-risk scenarios (lost all factors), provide a clear path to human-assisted recovery with identity proofing.</li>
  <li><strong>Audit logging</strong> â€” log every recovery attempt, successful or not, for compliance and fraud detection.</li>
  <li><strong>Cooldown periods</strong> â€” after account recovery, restrict sensitive actions (password change, email change) for 24â€“48 hours to limit damage from social engineering.</li>
  <li><strong>Re-enroll, don't just restore</strong> â€” after recovery, force MFA re-enrollment rather than restoring the old configuration.</li>
</ul>

<div class="nist">
  <strong>ðŸ“‹ NIST 800-63B Â§6.1.2.3:</strong> Recovery of an authenticator requires proof of the same or higher AAL as the authenticator being replaced. Recovery SHALL NOT downgrade the assurance level. Backup authenticators (recovery codes) should be issued at enrollment time.
</div>

<div class="impl">
  <strong>ForgeRock Implementation:</strong> Build an <code>Account Recovery</code> journey with branching logic: <strong>Choice Collector</strong> (recovery method selection) â†’ branch to Email Suspend, SMS OTP, or Backup Code verification. Use a <strong>Scripted Decision Node</strong> to check which recovery factors the user has enrolled. For backup codes, use <code>fr-attr: recovery-codes</code> in the user profile and a scripted node to validate + consume codes. After verification, route to an <strong>MFA Registration</strong> inner journey to re-enroll. Use the <strong>Account Lockout Node</strong> or scripted <code>inetUserStatus</code> check for locked accounts. For high-risk recovery, integrate <strong>Onfido</strong> or <strong>Jumio</strong> via marketplace connectors for document verification. Enable <strong>Audit Logging</strong> at the journey level â€” all events write to <code>am-authentication</code> topic.
</div>

<h2>Summary: Key Principles</h2>
<ul>
  <li><strong>Minimize friction at every step</strong> â€” only ask for what you need, when you need it.</li>
  <li><strong>Never reveal account existence</strong> â€” generic messages prevent enumeration attacks.</li>
  <li><strong>Defense in depth</strong> â€” layer email + OTP + risk signals; no single point of failure.</li>
  <li><strong>Follow NIST 800-63B</strong> â€” it's the gold standard for digital identity. No security questions, no arbitrary password rules.</li>
  <li><strong>Plan for loss</strong> â€” every enrolled credential must have a recovery path planned upfront.</li>
  <li><strong>Log everything</strong> â€” authentication and recovery events are critical for security and compliance.</li>
  <li><strong>ForgeRock journeys are composable</strong> â€” use inner trees for reusable sub-flows (MFA enrollment, email verification) shared across registration, login, and recovery.</li>
</ul>

</div>

<footer>
  Built by Bel Â· <a href="https://github.com/belcaps094850-sketch/forgerock-learning-lab">View on GitHub</a>
</footer>

</div>

</body>
</html>
